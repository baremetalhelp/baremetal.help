(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[638],{5960:function(e,n,t){"use strict";t.r(n),t.d(n,{assets:function(){return c},contentTitle:function(){return u},default:function(){return m},frontMatter:function(){return l},metadata:function(){return p},toc:function(){return d}});var s=t(7462),i=t(3366),a=(t(7294),t(3905)),o=t(3456),r=["components"],l={sidebar_position:3},u="SSO Landing Zone",p={unversionedId:"permission-sets/index",id:"permission-sets/index",title:"SSO Landing Zone",description:"Single Sign-On provides a way to associate users and groups in the enterprise. Usually, this delegates to something like Active Directory.",source:"@site/docs/permission-sets/index.md",sourceDirName:"permission-sets",slug:"/permission-sets/",permalink:"/docs/permission-sets/",editUrl:"https://github.com/baremetalhelp/baremetal.help/docs/permission-sets/index.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Same Thing With Pictures",permalink:"/docs/sso/sso-picture-book"},next:{title:"BareMetal Documentation",permalink:"/docs/docusaurus/"}},c={},d=[{value:"Assumptions",id:"assumptions",level:2},{value:"Preparation",id:"preparation",level:2},{value:"Get the list of AWS Accounts",id:"get-the-list-of-aws-accounts",level:3},{value:"Get the list of SSO Group IDs",id:"get-the-list-of-sso-group-ids",level:3},{value:"Configure permissions",id:"configure-permissions",level:3},{value:"Now glue everything together",id:"now-glue-everything-together",level:2},{value:"Deploy the SSO stack",id:"deploy-the-sso-stack",level:2},{value:"Behind the scenes",id:"behind-the-scenes",level:2},{value:"Resources",id:"resources",level:2},{value:"Verification",id:"verification",level:2}],h={toc:d};function m(e){var n=e.components,l=(0,i.Z)(e,r);return(0,a.kt)("wrapper",(0,s.Z)({},h,l,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"sso-landing-zone"},"SSO Landing Zone"),(0,a.kt)("p",null,"Single Sign-On provides a way to associate users and groups in the enterprise. Usually, this delegates to something like Active Directory."),(0,a.kt)("p",null,"But there's another piece that must be implemented that lets users see accounts and permissions one they have signed on. This is done with ",(0,a.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/singlesignon/latest/userguide/permissionsetsconcept.html"},"AWS Permission Sets"),". That's what you're going to do now."),(0,a.kt)("p",null,"Unless you do this bit, users will be able to log in using SSO just fine, but they won't see any available accounts when they do. "),(0,a.kt)("p",null,"Here's how the different entities are related. Looks complicated, but follow it through anyway."),(0,a.kt)(o.Mermaid,{config:{},chart:'stateDiagram-v2\n   state "AWS Organization" as organization\n   state "SSO Identity Provider" as directory\n   state "SSO Groups" as groups\n   state "SSO Users" as users\n   state "AWS Accounts" as accounts\n   state "AWS Permission Sets" as permission_sets\n   state "Permission Set Assignments" as permission_set_assignments\n   state "AWS Landing Zone" as landing_zone\n   organization --\x3e accounts : contains\n   directory --\x3e groups : provides\n   directory --\x3e users : provides\n   groups --\x3e permission_set_assignments : binds\n   accounts --\x3e permission_set_assignments : binds\n   permission_sets --\x3e permission_set_assignments : binds\n   permission_set_assignments --\x3e landing_zone : configures\n   users --\x3e landing_zone : logs in via SSO\n   note right of permission_set_assignments : You are here\n   note left of landing_zone : You\'ll make this',mdxType:"Mermaid"}),(0,a.kt)("h2",{id:"assumptions"},"Assumptions"),(0,a.kt)("p",null,'See the general assumptions in "About BareMetal tutorials".'),(0,a.kt)("p",null,"In addition"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"You have set up a ",(0,a.kt)("a",{parentName:"li",href:"../docs/organization"},"BareMetal AWS Organization")),(0,a.kt)("li",{parentName:"ol"},"You have created some accounts in the organization"),(0,a.kt)("li",{parentName:"ol"},"You have SSO integration ready because you ",(0,a.kt)("a",{parentName:"li",href:"../docs/sso/follow-instructions"},"followed the instructions")," or ",(0,a.kt)("a",{parentName:"li",href:"../docs/sso/sso-picture-book"},"looked at the pictures"))),(0,a.kt)("h2",{id:"preparation"},"Preparation"),(0,a.kt)("p",null,"The CDK stack for the Landing Zone is data-driven. This means we made it easy for you create assignments of SSO groups to accounts. SSO users in those groups will see accounts assigned to the groups they're in when they log in. This is the Landing Zone."),(0,a.kt)("p",null,"You're going to collect ids for AWS Accounts and SSO Groups an add those to a data structure. The CDK stack will traverse this data structure and create the corresponding AWS resources for the Landing Zone. We do the loops and create the resources so you don't have to."),(0,a.kt)("p",null,"A big advantage of making this part data driven is that since we're using TypeScript, we can make the data type safe so you don't mess it up. And you don't have to worry about all the plumbing. All you need to do it gather the rights ids."),(0,a.kt)("p",null,"The configuration file ig ",(0,a.kt)("inlineCode",{parentName:"p"},"landing-zone-config.ts")," ","[link]","."),(0,a.kt)("p",null,"In summary, you'll"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Make a list of AWS Accounts"),(0,a.kt)("li",{parentName:"ol"},"Make a list of SSO Groups"),(0,a.kt)("li",{parentName:"ol"},"Define AWS Permission Sets that grant SSO Users in SSO Groups permissions in AWS Accounts"),(0,a.kt)("li",{parentName:"ol"},'Press the "go" button')),(0,a.kt)("h3",{id:"get-the-list-of-aws-accounts"},"Get the list of AWS Accounts"),(0,a.kt)("p",null,"Open the AWS console to the AWS Organizations page. Open up the tree of Organization Units. Any accounts present in the Organization will appear here. For example"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"AWS Organizations console",src:t(9538).Z,width:"3256",height:"2826"})),(0,a.kt)("p",null,"shows account names and numbers."),(0,a.kt)("p",null,"For each AWS account you want to include in the Landing Zone, add a value to the ",(0,a.kt)("inlineCode",{parentName:"p"},"enum Account")," like this."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},'export enum Account {\n    BILLING_ACCOUNT = "825617765789",\n    SANDBOX = "772866064453",\n    PREPROD1 = "921112571860",\n    PROD1 = "644590569382",\n    AUDIT = "405828339838",\n    LOG_ARCHIVE = "937567863100",\n}\n')),(0,a.kt)("p",null,"An ",(0,a.kt)("inlineCode",{parentName:"p"},"enum")," is better than constants because we can use them in type-safe data structures. Remember these are strings.",(0,a.kt)("sup",{parentName:"p",id:"fnref-1"},(0,a.kt)("a",{parentName:"sup",href:"#fn-1",className:"footnote-ref"},"1"))),(0,a.kt)("h3",{id:"get-the-list-of-sso-group-ids"},"Get the list of SSO Group IDs"),(0,a.kt)("p",null,"Open the AWS SSO Console. Click ",(0,a.kt)("em",{parentName:"p"},"Groups"),". Click a group you want to available in the Landing Zone. Copy the ",(0,a.kt)("em",{parentName:"p"},"Group ID"),". These ids are GUIDs with a prefix."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"SSO Groups console",src:t(134).Z,width:"3256",height:"2826"})),(0,a.kt)("p",null,"Now update the ",(0,a.kt)("inlineCode",{parentName:"p"},"enum")," for SSO Groups, just like you did for AWS Accounts."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},'export enum Group {\n    ADMINISTRATOR = "9067420728-45df392d-85da-4751-9f20-47fb268d3709",\n    VIEW_ONLY = "9067420728-101bc3b4-7cbc-4b31-9bfe-4a50632d72b8",\n    READ_ONLY = "9067420728-b8b4d794-4d00-4b87-a1b2-7c58ca76c3a2",\n    DEVELOPER = "9067420728-e78cfac1-937f-459a-98f7-1a4fe90b5772",\n}\n')),(0,a.kt)("h3",{id:"configure-permissions"},"Configure permissions"),(0,a.kt)("p",null,"Each SSO Group can be assigned to multiple AWS Accounts. And for each assignment, you need to specify the permissions an SSO User in that SSO Group will have in each account."),(0,a.kt)("p",null,"There's a data structure."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"export interface PermissionSetConfig {\n    name: string;\n    awsManagedPolicyNames?: string[];\n    inlinePolicyStatements?: PolicyStatement[];\n}\n")),(0,a.kt)("p",null,"Here's the Administrator Permission Set config, defined in ",(0,a.kt)("inlineCode",{parentName:"p"},"permission-sets.ts")," ","[link]"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},'export const adminPermissionSetConfig: PermissionSetConfig = {\n    name: "ADMINISTRATOR",\n    awsManagedPolicyNames: [ManagedPolicies.ADMINISTRATOR_ACCESS],\n};\n')),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"name")," has to be unique. We're using upper case but that's just a habit."),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"awsManagedPolicyNames")," is an array of ",(0,a.kt)("inlineCode",{parentName:"p"},"string"),"s that correspond to AWS-provided policies. We're using the JavaScript library ",(0,a.kt)("inlineCode",{parentName:"p"},"cdk-constants"),", which makes it easy not to mess up spelling."),(0,a.kt)("p",null,"In the above, the ",(0,a.kt)("inlineCode",{parentName:"p"},"inlinePolicy")," was omitted. We'll make a Permission Set in a bit that has an inline policy so you can see what that's about."),(0,a.kt)("p",null,"Define as many of these as you have roles, job functions, or however else you plan to administer access."),(0,a.kt)("h2",{id:"now-glue-everything-together"},"Now glue everything together"),(0,a.kt)("p",null,"In the file ",(0,a.kt)("inlineCode",{parentName:"p"},"landing-zone-config.ts"),", see the interface ",(0,a.kt)("inlineCode",{parentName:"p"},"GroupAssignment")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"interface GroupAssignment {\n    group: Group;\n    accounts: Account[];\n    permissionSetConfig: PermissionSetConfig;\n}\n")),(0,a.kt)("p",null,"We define data in this structure that binds everything together."),(0,a.kt)("p",null,"Add elements to the ",(0,a.kt)("inlineCode",{parentName:"p"},"landingZoneConfig")," like this"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"export const landingZoneConfig: GroupAssignment[] = [\n    // Administrator\n    //\n    {\n        group: Group.ADMINISTRATOR,\n        accounts: [\n            Account.BILLING_ACCOUNT,\n            Account.SANDBOX,\n            Account.PREPROD1,\n            Account.PROD1,\n            Account.AUDIT,\n            Account.LOG_ARCHIVE,\n        ],\n        permissionSetConfig: adminPermissionSetConfig,\n    },\n    ...\n")),(0,a.kt)("p",null,"Here, ",(0,a.kt)("inlineCode",{parentName:"p"},"group")," is a value from your ",(0,a.kt)("inlineCode",{parentName:"p"},"enum")," for SSO Groups. ",(0,a.kt)("inlineCode",{parentName:"p"},"accounts")," is an array that defines which AWS Accounts in the Landing Zone will be available for this SSO Group."),(0,a.kt)("p",null,"And ",(0,a.kt)("inlineCode",{parentName:"p"},"permissionSetConfig")," is the permissions you defined previously. You can define this permission configuration inline like this if you want."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},' {\n        group: Group.ADMINISTRATOR,\n        accounts: [\n            Account.BILLING_ACCOUNT,\n            Account.SANDBOX,\n            Account.PREPROD1,\n            Account.PROD1,\n            Account.AUDIT,\n            Account.LOG_ARCHIVE,\n        ],\n        permissionSetConfig: {\n            name: "ADMINISTRATOR",\n            awsManagedPolicyNames: [ManagedPolicies.ADMINISTRATOR_ACCESS],\n        },\n    },\n')),(0,a.kt)("h2",{id:"deploy-the-sso-stack"},"Deploy the SSO stack"),(0,a.kt)("p",null,"Blah"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"cdk --profile baremetal.help --region us-east-1 deploy BareMetalLandingZone\n")),(0,a.kt)("p",null,"Blah"),(0,a.kt)("h2",{id:"behind-the-scenes"},"Behind the scenes"),(0,a.kt)("p",null,"Blah"),(0,a.kt)("h2",{id:"resources"},"Resources"),(0,a.kt)("p",null,"Blah."),(0,a.kt)("h2",{id:"verification"},"Verification"),(0,a.kt)("p",null,"Blah."),(0,a.kt)("p",null,(0,a.kt)("sup",{parentName:"p",id:"fnref-1"},(0,a.kt)("a",{parentName:"sup",href:"#fn-1",className:"footnote-ref"},"1"))," Perhaps we could have used numbers here, but we're not sure how good AWS is at not starting account numbers with ",(0,a.kt)("inlineCode",{parentName:"p"},"0"),"."))}m.isMDXComponent=!0},1748:function(e,n,t){var s={"./locale":9234,"./locale.js":9234};function i(e){var n=a(e);return t(n)}function a(e){if(!t.o(s,e)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return s[e]}i.keys=function(){return Object.keys(s)},i.resolve=a,e.exports=i,i.id=1748},134:function(e,n,t){"use strict";n.Z=t.p+"assets/images/aws-console-group-id-3e54b2bba62461cf01fe997a9f79c0e3.png"},9538:function(e,n,t){"use strict";n.Z=t.p+"assets/images/aws-console-organizations-61ae99bc1a7bbf3ad9d07701891b2fc3.png"}}]);