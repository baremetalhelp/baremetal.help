(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[737],{29240:function(e,t,a){"use strict";a.r(t),a.d(t,{assets:function(){return u},contentTitle:function(){return c},default:function(){return h},frontMatter:function(){return l},metadata:function(){return d},toc:function(){return m}});var o=a(87462),n=a(63366),r=(a(67294),a(3905)),i=a(93456),s=["components"],l={sidebar_position:5},c="BareMetal CDN",d={unversionedId:"cdn/index",id:"cdn/index",title:"BareMetal CDN",description:"We're going to build a Content Delivery Network, CDN, from scratch. A CDN serves web objects like images from locations that are geographically close to consumers. That means better latency for users and less load on your resources. It's a very common pattern.",source:"@site/docs/cdn/index.md",sourceDirName:"cdn",slug:"/cdn/",permalink:"/docs/cdn/",editUrl:"https://github.com/baremetalhelp/baremetal.help/docs/cdn/index.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"About BareMetal Tutorials",permalink:"/docs/intro"},next:{title:"Create AWS Organization",permalink:"/docs/organization/"}},u={},m=[{value:"Architecture",id:"architecture",level:2},{value:"Assumptions",id:"assumptions",level:2},{value:"Required Configuration",id:"required-configuration",level:2},{value:"Deploy",id:"deploy",level:2},{value:"Resources",id:"resources",level:2},{value:"Verification",id:"verification",level:2}],p={toc:m};function h(e){var t=e.components,a=(0,n.Z)(e,s);return(0,r.kt)("wrapper",(0,o.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"baremetal-cdn"},"BareMetal CDN"),(0,r.kt)("p",null,"We're going to build a Content Delivery Network, CDN, from scratch. A CDN serves web objects like images from locations that are geographically close to consumers. That means better latency for users and less load on your resources. It's a very common pattern."),(0,r.kt)("p",null,"CDNs cache too. So you only need to copy the original to one place (the ",(0,r.kt)("em",{parentName:"p"},"origin"),") and the CDN takes care of copying to edge locations on a cache miss. Origin is an S3 Bucket, but could be an API."),(0,r.kt)("h2",{id:"architecture"},"Architecture"),(0,r.kt)(i.Mermaid,{config:{},chart:'stateDiagram-v2\n  state "AWS CloudFront" as cloudfront\n  state "Origin: AWS S3 Bucket" as origin\n  state "Route 53 HostedZone" as hosted_zone\n  state "SSL Certificate" as ssl_cert\n  state "DNS Alias Record" as a_record\n  state "AWS Certificate Manager" as acm\n  state "CloudWatch" as cloudwatch\n  state "Certificate Expiry Alarm" as expiry_alarm\n  cloudwatch --\x3e expiry_alarm\n  cloudfront --\x3e origin : read-through cache\n  hosted_zone --\x3e a_record\n  a_record --\x3e cloudfront : cdn.baremetal.help\n  acm --\x3e ssl_cert',mdxType:"Mermaid"}),(0,r.kt)("h2",{id:"assumptions"},"Assumptions"),(0,r.kt)("p",null,"See the ",(0,r.kt)("a",{parentName:"p",href:"intro#overall-assumptions"},'overall assumptions in "About BareMetal Tutorials"'),"."),(0,r.kt)("p",null,"In addition"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"You registered a domain (strongly recommended). There are more places to register domains than you can count. Here's ",(0,r.kt)("a",{parentName:"li",href:"https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/domain-register.html"},"how to do that on AWS"),". Things will go much more smoothly if you use AWS as your registrar, because the CDN stack as-is will add DNS records for the SSL certificate automatically in AWS. And you need to do that to prove you own the domain you're creating the SSL certificate for."),(0,r.kt)("li",{parentName:"ol"},"You have content \u2014 like images and CSS \u2014 you want to serve to web applications or mobile apps.")),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"You can serve content from an internal HTTP endpoint without a domain you own, but the URL of that endpoint can change if you delete and recreate the CDN."),(0,r.kt)("p",{parentName:"div"},"If you write applications that rely on the internal URL, you'll have to change them.\nIt's an random internal name created for you by AWS."),(0,r.kt)("p",{parentName:"div"},"If you just want to play with a CDN or don't have a custom domain, your best bet is to use the ",(0,r.kt)("a",{parentName:"p",href:"https://aws.amazon.com/cloudfront/"},"AWS console")," directly rather than deploy the stack for this tutorial."))),(0,r.kt)("p",null,"In this repo at the top level, run this to see a list of all the BareMetal stacks."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cdk ls\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"BareMetalCdn")," is the stack for this tutorial. You'll deploy that in a bit."),(0,r.kt)("h2",{id:"required-configuration"},"Required Configuration"),(0,r.kt)("p",null,"The CDN stack requires the following configuration."),(0,r.kt)("p",null,"In ",(0,r.kt)("inlineCode",{parentName:"p"},"config/common-config.ts"),", change the common configuration values to your domain. With the current version, the apex domain for publishing documentation."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'const bareMetalConfig: BareMetalConfig = {\n  domainName: "example.com",\n  cdnEndpoint: "cdn.example.com",\n};\n')),(0,r.kt)("h2",{id:"deploy"},"Deploy"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cdk deploy BareMetalCdn\n")),(0,r.kt)("h2",{id:"resources"},"Resources"),(0,r.kt)("p",null,"Blah."),(0,r.kt)("h2",{id:"verification"},"Verification"),(0,r.kt)("p",null,"Blah."))}h.isMDXComponent=!0},11748:function(e,t,a){var o={"./locale":89234,"./locale.js":89234};function n(e){var t=r(e);return a(t)}function r(e){if(!a.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}n.keys=function(){return Object.keys(o)},n.resolve=r,e.exports=n,n.id=11748}}]);